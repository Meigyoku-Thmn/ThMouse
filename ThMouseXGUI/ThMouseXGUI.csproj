<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <OutputType>WinExe</OutputType>
        <TargetFramework>net48</TargetFramework>
        <UseWindowsForms>true</UseWindowsForms>
        <ImplicitUsings>enable</ImplicitUsings>
        <LangVersion>12</LangVersion>
        <ApplicationIcon>ThMouseX.ico</ApplicationIcon>
        <Prefer32Bit>true</Prefer32Bit>
        <DisableFastUpToDateCheck>True</DisableFastUpToDateCheck>
        <Version>3.0.0</Version>
        <Platforms>x86</Platforms>
    </PropertyGroup>

    <ItemGroup>
        <None Remove=".gitignore" />
        <Content Include="ThMouseX.ico" />
        <ProjectReference Include="..\ThMouseXServer\ThMouseXServer.csproj" />
    </ItemGroup>

    <Target Name="PostBuild" AfterTargets="PostBuildEvent">
        <PropertyGroup>
            <PostBuildScript>
                <![CDATA[
call "$(DevEnvDir)..\Tools\vsdevcmd.bat" -no_logo
xcopy "$(SolutionDir)$(Configuration)\*" "$(ProjectDir)$(OutDir)" /y /s /d
    if %errorlevel% neq 0 exit /b %errorlevel%
xcopy "$(SolutionDir)NeoLuaBootstrap\bin\x86\$(Configuration)\net48\*" "$(ProjectDir)$(OutDir)" /y /s /d
    if %errorlevel% neq 0 exit /b %errorlevel%
set ServerManifestPath="$(SolutionDir)ThMouseXServer\server.manifest"
set ComServerPath="$(ProjectDir)$(OutDir)ThMouseXGUI.exe;#1"
mt -nologo -manifest %ServerManifestPath% -outputresource:%ComServerPath%
                ]]>
            </PostBuildScript>
        </PropertyGroup>
        <Exec Command="$(PostBuildScript)" />
    </Target>

</Project>